name: Any Test

on:
  workflow_dispatch:
    inputs:
      # --- 1. 基础信息 (String) ---
      project_name:
        type: string
        description: "项目名称"
        required: true
        default: "My Awesome App"

      # --- 2. 部署环境 (Environment) ---
      deploy_env:
        type: environment
        description: "选择部署环境"
        required: true
        default: "production"

      # --- 3. 核心应用 (Choice 单选) ---
      main_engine:
        type: choice
        description: "选择主引擎"
        options:
          - caddy
          - nginx
          - apache
        default: "caddy"

      # --- 4. 扩展组件 (多个 Boolean 实现“多选框”效果) ---
      include_redis:
        type: boolean
        description: "勾选以包含: Redis"
        default: false
      include_mongodb:
        type: boolean
        description: "勾选以包含: MongoDB"
        default: false
      include_grafana:
        type: boolean
        description: "勾选以包含: Grafana"
        default: false

      # --- 5. 调试控制 (Boolean & Number) ---
      enable_debug:
        type: boolean
        description: "开启调试输出"
        default: false
      retry_limit:
        type: number
        description: "失败重试次数"
        default: 3
        
      services:
        type: string
        description: "输入要启动的服务（逗号分隔）"
        default: "caddy,nginx"


jobs:
  display_and_run:
    name: "处理所有输入项"
    runs-on: ubuntu-latest
    steps:
      - name: 1. 打印基础配置
        run: |
          echo "项目: ${{ inputs.project_name }}"
          echo "主引擎: ${{ inputs.main_engine }}"
          echo "部署环境: ${{ inputs.deploy_env }}"

      - name: 2. 处理多选框内容 (Conditional Steps)
        run: |
          echo "正在检查勾选的组件..."
          # 这里演示如何在 Shell 里判断多个勾选框
          [[ "${{ inputs.include_redis }}" == "true" ]] && echo "✅ 已选中 Redis" || echo "❌ 未选中 Redis"
          [[ "${{ inputs.include_mongodb }}" == "true" ]] && echo "✅ 已选中 MongoDB" || echo "❌ 未选中 MongoDB"
          [[ "${{ inputs.include_grafana }}" == "true" ]] && echo "✅ 已选中 Grafana" || echo "❌ 未选中 Grafana"

      - name: 3. 模拟安装选中的组件
        # 使用 if 进行更精细的控制
        run: |
          if [ "${{ inputs.include_redis }}" == "true" ]; then
            echo "正在安装 Redis 模块..."
          fi
          if [ "${{ inputs.include_mongodb }}" == "true" ]; then
            echo "正在安装 MongoDB 模块..."
          fi

      - name: 4. 调试模式
        if: ${{ inputs.enable_debug }}
        run: |
          echo "--- 调试信息 ---"
          echo "重试限制: ${{ inputs.retry_limit }}"
          echo "触发者: ${{ github.actor }}"

      - name: 检测服务
        run: |
          # 使用 contains 判断字符串里有没有对应的服务名
          if [[ "${{ inputs.services }}" == *"caddy"* ]]; then echo "Caddy selected"; fi
          if [[ "${{ inputs.services }}" == *"nginx"* ]]; then echo "Nginx selected"; fi

  # 演示如何根据多选框触发独立的 Job
  database_setup:
    name: "数据库专项任务"
    runs-on: ubuntu-latest
    # 只要勾选了 Redis 或 MongoDB 其中的任何一个，这个 Job 就会运行
    if: ${{ inputs.include_redis || inputs.include_mongodb }}
    steps:
      - run: echo "检测到数据库组件需求，正在配置数据库环境..."

      - name: nginx hello
        run: |
          echo ${{ github.event.inputs.region == 'US' || github.event.inputs.region == 'ALL' }}
          echo "${{ github.event.inputs.region }}"
